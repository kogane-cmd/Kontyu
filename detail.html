<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>作品詳細</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h1 { color: green; }
    .info { margin-top: 10px; }
    img { max-width: 400px; margin-top: 10px; }
    .back { margin-top: 20px; display: inline-block; }
  </style>
</head>
<body>
  <h1 id="title">作品詳細</h1>
  <div id="info" class="info"></div>
  <img id="image" alt="作品画像">
  <p><strong>説明:</strong></p>
  <p id="description"></p>
  <a href="list.html" class="back">← リストに戻る</a>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Firebase設定
    const firebaseConfig = {
      apiKey: "AIzaSyCScKcpIL1xX2gGDpVS3HpIof0_QONLULm8",
      authDomain: "kontyu-project.firebaseapp.com",
      projectId: "kontyu-project",
      storageBucket: "kontyu-project.appspot.com",
      messagingSenderId: "1029388457127",
      appId: "1:1029388457127:web:e4da23d8c3cab39de03782"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // URLパラメータからid取得
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    async function loadDetail() {
      if (!id) {
        document.getElementById("info").textContent = "作品が見つかりません。";
        return;
      }

      const ref = doc(db, "insects", id);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        document.getElementById("info").textContent = "作品が見つかりません。";
        return;
      }

      const data = snap.data();

      document.getElementById("title").textContent = data.name || "名称なし";
      document.getElementById("info").innerHTML = `
        <p><strong>作成者:</strong> ${data.user || "匿名"}</p>
        <p><strong>登録日:</strong> ${data.date || ""}</p>
        <p><strong>アクセス数:</strong> ${data.views || 0}</p>
      `;
      document.getElementById("description").textContent = data.description || "説明なし";
      if (data.image) {
        document.getElementById("image").src = data.image;
      } else {
        document.getElementById("image").style.display = "none";
      }

      // アクセス数を+1
      await updateDoc(ref, { views: increment(1) });
    }

    loadDetail();
  </script>
</body>
</html>
